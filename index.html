<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HostelHive - Smart Expense Tracking for Students & Professionals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, addDoc, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Firebase Globals (Provided by Canvas Environment) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Check for required Firebase config
        if (!firebaseConfig.apiKey) {
            console.error("Firebase config is missing. Please ensure it's provided.");
        }
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Make the Firebase objects available globally
        window.firebase = {
            auth, db, appId, initialAuthToken,
            createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken,
            doc, getDoc, setDoc, onSnapshot, collection, addDoc, query, where
        };
        console.log("Firebase SDKs loaded and initialized.");
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-bg-alt {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dark {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
        }
        
        .dark .glass {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg transition-all duration-300">
    <!-- Toast Notification -->
    <div id="toast" class="toast glass rounded-2xl p-4 text-white shadow-xl">
        <div class="flex items-center space-x-3">
            <i id="toast-icon" class="fas fa-check-circle text-green-400"></i>
            <span id="toast-message">Success!</span>
        </div>
    </div>
    
    <!-- Modal for Alerts -->
    <div id="alert-modal" class="modal">
        <div class="glass rounded-3xl p-6 w-full max-w-sm mx-4 text-center">
            <div class="flex justify-center mb-4">
                <i id="alert-icon" class="fas fa-exclamation-triangle text-3xl text-yellow-400"></i>
            </div>
            <h3 id="alert-title" class="text-xl font-semibold text-white mb-2">Alert</h3>
            <p id="alert-message" class="text-white/80 mb-6">This is an alert message.</p>
            <div class="flex gap-4 justify-center">
                <button id="alert-confirm" class="gradient-bg-alt rounded-xl py-3 px-6 text-white font-semibold hover:opacity-90 transition-all">
                    OK
                </button>
                <button id="alert-cancel" class="glass rounded-xl py-3 px-6 text-white font-semibold hover:bg-white/20 transition-all hidden">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="glass rounded-2xl m-4 p-4 shadow-xl">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 gradient-bg-alt rounded-xl flex items-center justify-center">
                    <i class="fas fa-home text-white text-lg"></i>
                </div>
                <h1 class="text-2xl font-bold text-white">HostelHive</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="glass rounded-xl p-3 text-white hover:bg-white/20 transition-all">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="nav-login" class="glass rounded-xl px-6 py-3 text-white hover:bg-white/20 transition-all">
                    Login
                </button>
                <button id="nav-signup" class="gradient-bg-alt rounded-xl px-6 py-3 text-white hover:opacity-90 transition-all">
                    Sign Up
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div id="main-content">
        <!-- Landing Page -->
        <div id="landing-page">
            <!-- Hero Section -->
            <section class="px-4 py-20 text-center">
                <div class="max-w-6xl mx-auto">
                    <div class="animate-float mb-8">
                        <div class="w-24 h-24 gradient-bg-alt rounded-3xl mx-auto flex items-center justify-center mb-6">
                            <i class="fas fa-chart-line text-white text-3xl"></i>
                        </div>
                    </div>
                    <h1 class="text-5xl md:text-7xl font-bold text-white mb-6">
                        Smart Money Management for
                        <span class="gradient-bg-alt bg-clip-text text-transparent">Hostel Life</span>
                    </h1>
                    <p class="text-xl text-white/80 mb-8 max-w-3xl mx-auto">
                        Track expenses, manage budgets, and achieve financial goals. Perfect for college students and working professionals living in hostels and PGs.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button id="hero-signup" class="gradient-bg-alt rounded-2xl px-8 py-4 text-white font-semibold hover:opacity-90 transition-all transform hover:scale-105">
                            Start Tracking Free
                        </button>
                        <button id="hero-demo" class="glass rounded-2xl px-8 py-4 text-white font-semibold hover:bg-white/20 transition-all">
                            View Demo
                        </button>
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <section class="px-4 py-20">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-4xl font-bold text-white text-center mb-16">Why Choose HostelHive?</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="glass rounded-3xl p-8 text-center hover:bg-white/20 transition-all">
                            <div class="w-16 h-16 gradient-bg rounded-2xl mx-auto mb-6 flex items-center justify-center">
                                <i class="fas fa-mobile-alt text-white text-2xl"></i>
                            </div>
                            <h3 class="text-2xl font-semibold text-white mb-4">Mobile-First Design</h3>
                            <p class="text-white/70">Optimized for your phone. Track expenses on the go, anytime, anywhere.</p>
                        </div>
                        <div class="glass rounded-3xl p-8 text-center hover:bg-white/20 transition-all">
                            <div class="w-16 h-16 gradient-bg rounded-2xl mx-auto mb-6 flex items-center justify-center">
                                <i class="fas fa-chart-pie text-white text-2xl"></i>
                            </div>
                            <h3 class="text-2xl font-semibold text-white mb-4">Smart Analytics</h3>
                            <p class="text-white/70">Visual insights and trends to understand your spending patterns better.</p>
                        </div>
                        <div class="glass rounded-3xl p-8 text-center hover:bg-white/20 transition-all">
                            <div class="w-16 h-16 gradient-bg rounded-2xl mx-auto mb-6 flex items-center justify-center">
                                <i class="fas fa-shield-alt text-white text-2xl"></i>
                            </div>
                            <h3 class="text-2xl font-semibold text-white mb-4">Secure & Private</h3>
                            <p class="text-white/70">Your financial data is encrypted and secure. We never share your information.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Testimonials -->
            <section class="px-4 py-20">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="text-4xl font-bold text-white mb-16">What Students Say</h2>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="glass rounded-3xl p-8">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 gradient-bg-alt rounded-full flex items-center justify-center mr-4">
                                    <span class="text-white font-semibold">A</span>
                                </div>
                                <div>
                                    <h4 class="text-white font-semibold">Arjun Patel</h4>
                                    <p class="text-white/60">Engineering Student</p>
                                </div>
                            </div>
                            <p class="text-white/80">"HostelHive helped me save ₹5000 last month! The budget alerts are a lifesaver."</p>
                        </div>
                        <div class="glass rounded-3xl p-8">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 gradient-bg-alt rounded-full flex items-center justify-center mr-4">
                                    <span class="text-white font-semibold">P</span>
                                </div>
                                <div>
                                    <h4 class="text-white font-semibold">Priya Sharma</h4>
                                    <p class="text-white/60">Working Professional</p>
                                </div>
                            </div>
                            <p class="text-white/80">"Finally, an expense tracker that understands hostel life. Simple and effective!"</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FAQ Section -->
            <section class="px-4 py-20">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-4xl font-bold text-white text-center mb-16">Frequently Asked Questions</h2>
                    <div class="space-y-4">
                        <div class="glass rounded-2xl p-6">
                            <button class="faq-toggle w-full text-left flex items-center justify-between text-white font-semibold">
                                <span>Is HostelHive free to use?</span>
                                <i class="fas fa-chevron-down transition-transform"></i>
                            </button>
                            <div class="faq-content hidden mt-4 text-white/80">
                                Yes! HostelHive is completely free for all students and working professionals. No hidden charges.
                            </div>
                        </div>
                        <div class="glass rounded-2xl p-6">
                            <button class="faq-toggle w-full text-left flex items-center justify-between text-white font-semibold">
                                <span>How secure is my financial data?</span>
                                <i class="fas fa-chevron-down transition-transform"></i>
                            </button>
                            <div class="faq-content hidden mt-4 text-white/80">
                                We use bank-level encryption to protect your data. Your information is stored securely and never shared with third parties.
                            </div>
                        </div>
                        <div class="glass rounded-2xl p-6">
                            <button class="faq-toggle w-full text-left flex items-center justify-between text-white font-semibold">
                                <span>Can I export my expense reports?</span>
                                <i class="fas fa-chevron-down transition-transform"></i>
                            </button>
                            <div class="faq-content hidden mt-4 text-white/80">
                                Absolutely! You can download your expense reports in PDF or CSV format for your records.
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Contact Section -->
            <section class="px-4 py-20">
                <div class="max-w-2xl mx-auto text-center">
                    <h2 class="text-4xl font-bold text-white mb-8">Get Started Today</h2>
                    <p class="text-xl text-white/80 mb-8">Join thousands of students already managing their finances smarter.</p>
                    <button id="footer-signup" class="gradient-bg-alt rounded-2xl px-8 py-4 text-white font-semibold hover:opacity-90 transition-all transform hover:scale-105">
                        Create Free Account
                    </button>
                </div>
            </section>
        </div>

        <!-- Auth Pages -->
        <div id="auth-page" class="hidden min-h-screen flex items-center justify-center p-4">
            <div class="glass rounded-3xl p-8 w-full max-w-md">
                <!-- Login Form -->
                <div id="login-form">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 gradient-bg-alt rounded-2xl mx-auto mb-4 flex items-center justify-center">
                            <i class="fas fa-user text-white text-2xl"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-white">Welcome Back</h2>
                        <p class="text-white/70">Sign in to your account</p>
                    </div>
                    
                    <form id="loginForm" class="space-y-6">
                        <div>
                            <input type="email" id="login-email" placeholder="Email address" required
                                class="w-full glass rounded-xl p-4 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                        </div>
                        <div>
                            <input type="password" id="login-password" placeholder="Password" required
                                class="w-full glass rounded-xl p-4 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                        </div>
                        <button type="submit" class="w-full gradient-bg-alt rounded-xl py-4 text-white font-semibold hover:opacity-90 transition-all">
                            Sign In
                        </button>
                    </form>
                    
                    <div class="mt-6 text-center">
                        <button id="show-signup" class="text-white/70 hover:text-white transition-all">
                            Don't have an account? <span class="text-purple-300">Sign up</span>
                        </button>
                    </div>
                    
                    <div class="mt-6 text-center">
                        <button id="back-to-home" class="text-white/70 hover:text-white transition-all">
                            ← Back to Home
                        </button>
                    </div>
                </div>

                <!-- Signup Form -->
                <div id="signup-form" class="hidden">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 gradient-bg-alt rounded-2xl mx-auto mb-4 flex items-center justify-center">
                            <i class="fas fa-user-plus text-white text-2xl"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-white">Create Account</h2>
                        <p class="text-white/70">Join HostelHive today</p>
                    </div>
                    
                    <form id="signupForm" class="space-y-6">
                        <div>
                            <input type="text" id="signup-name" placeholder="Full Name" required
                                class="w-full glass rounded-xl p-4 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                        </div>
                        <div>
                            <input type="email" id="signup-email" placeholder="Email address" required
                                class="w-full glass rounded-xl p-4 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                        </div>
                        <div>
                            <input type="password" id="signup-password" placeholder="Password (min 6 characters)" required minlength="6"
                                class="w-full glass rounded-xl p-4 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                        </div>
                        <button type="submit" class="w-full gradient-bg-alt rounded-xl py-4 text-white font-semibold hover:opacity-90 transition-all">
                            Create Account
                        </button>
                    </form>
                    
                    <div class="mt-6 text-center">
                        <button id="show-login" class="text-white/70 hover:text-white transition-all">
                            Already have an account? <span class="text-purple-300">Sign in</span>
                        </button>
                    </div>
                    
                    <div class="mt-6 text-center">
                        <button id="back-to-home-signup" class="text-white/70 hover:text-white transition-all">
                            ← Back to Home
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard-page" class="hidden min-h-screen p-4">
            <!-- Dashboard Navigation -->
            <nav class="glass rounded-2xl p-4 mb-6 shadow-xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 gradient-bg-alt rounded-xl flex items-center justify-center">
                            <i class="fas fa-home text-white text-lg"></i>
                        </div>
                        <h1 class="text-2xl font-bold text-white">HostelHive</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="user-info" class="text-white/80 text-sm md:text-base">Loading...</span>
                        <button id="logout-btn" class="glass rounded-xl px-4 py-2 text-white hover:bg-white/20 transition-all">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Dashboard Tabs -->
            <div class="glass rounded-2xl p-4 mb-6">
                <div class="flex flex-wrap gap-2">
                    <button class="tab-btn active gradient-bg-alt rounded-xl px-6 py-3 text-white font-semibold" data-tab="overview">
                        <i class="fas fa-chart-line mr-2"></i>Overview
                    </button>
                    <button class="tab-btn glass rounded-xl px-6 py-3 text-white font-semibold hover:bg-white/20 transition-all" data-tab="transactions">
                        <i class="fas fa-list mr-2"></i>Transactions
                    </button>
                    <button class="tab-btn glass rounded-xl px-6 py-3 text-white font-semibold hover:bg-white/20 transition-all" data-tab="budgets">
                        <i class="fas fa-piggy-bank mr-2"></i>Budgets
                    </button>
                    <button class="tab-btn glass rounded-xl px-6 py-3 text-white font-semibold hover:bg-white/20 transition-all" data-tab="reports">
                        <i class="fas fa-file-alt mr-2"></i>Reports
                    </button>
                    <button class="tab-btn glass rounded-xl px-6 py-3 text-white font-semibold hover:bg-white/20 transition-all" data-tab="settings">
                        <i class="fas fa-cog mr-2"></i>Settings
                    </button>
                </div>
            </div>

            <!-- Overview Tab -->
            <div id="overview-tab" class="tab-content">
                <!-- KPI Cards -->
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="glass rounded-3xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-white/80 font-medium">Total Income</h3>
                            <i class="fas fa-arrow-up text-green-400 text-xl"></i>
                        </div>
                        <p id="total-income" class="text-3xl font-bold text-white">₹0</p>
                        <p class="text-green-400 text-sm mt-2">This month</p>
                    </div>
                    <div class="glass rounded-3xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-white/80 font-medium">Total Expenses</h3>
                            <i class="fas fa-arrow-down text-red-400 text-xl"></i>
                        </div>
                        <p id="total-expenses" class="text-3xl font-bold text-white">₹0</p>
                        <p class="text-red-400 text-sm mt-2">This month</p>
                    </div>
                    <div class="glass rounded-3xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-white/80 font-medium">Balance</h3>
                            <i class="fas fa-wallet text-blue-400 text-xl"></i>
                        </div>
                        <p id="balance" class="text-3xl font-bold text-white">₹0</p>
                        <p id="balance-status" class="text-blue-400 text-sm mt-2">Available</p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid lg:grid-cols-2 gap-6 mb-8">
                    <div class="glass rounded-3xl p-6">
                        <h3 class="text-xl font-semibold text-white mb-4">Expense by Category</h3>
                        <div class="relative h-64 w-full">
                            <canvas id="categoryChart" class="max-w-full max-h-full"></canvas>
                        </div>
                    </div>
                    <div class="glass rounded-3xl p-6">
                        <h3 class="text-xl font-semibold text-white mb-4">Monthly Trend</h3>
                        <div class="relative h-64 w-full">
                            <canvas id="trendChart" class="max-w-full max-h-full"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Quick Add -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="glass rounded-3xl p-6">
                        <h3 class="text-xl font-semibold text-white mb-4">Quick Add Income</h3>
                        <form id="quick-income-form" class="space-y-4">
                            <input type="number" id="income-amount" placeholder="Amount (₹)" required
                                class="w-full glass rounded-xl p-3 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-green-400 outline-none">
                            <input type="text" id="income-description" placeholder="Description" required
                                class="w-full glass rounded-xl p-3 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-green-400 outline-none">
                            <select id="income-category" required
                                class="w-full glass rounded-xl p-3 text-white border-0 focus:ring-2 focus:ring-green-400 outline-none bg-white/10">
                                <option value="" class="bg-gray-800 text-white">Select Category</option>
                                <option value="Salary" class="bg-gray-800 text-white">Salary</option>
                                <option value="Freelance" class="bg-gray-800 text-white">Freelance</option>
                                <option value="Family" class="bg-gray-800 text-white">Family Support</option>
                                <option value="Scholarship" class="bg-gray-800 text-white">Scholarship</option>
                                <option value="Other" class="bg-gray-800 text-white">Other</option>
                            </select>
                            <button type="submit" class="w-full bg-green-500 hover:bg-green-600 rounded-xl py-3 text-white font-semibold transition-all">
                                Add Income
                            </button>
                        </form>
                    </div>
                    <div class="glass rounded-3xl p-6">
                        <h3 class="text-xl font-semibold text-white mb-4">Quick Add Expense</h3>
                        <div id="balance-warning" class="hidden mb-4 p-3 bg-yellow-500/20 border border-yellow-500/50 rounded-xl">
                            <div class="flex items-center text-yellow-300">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                <span class="text-sm">Available Balance: <span id="available-balance">₹0</span></span>
                            </div>
                        </div>
                        <form id="quick-expense-form" class="space-y-4">
                            <input type="number" id="expense-amount" placeholder="Amount (₹)" required
                                class="w-full glass rounded-xl p-3 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-red-400 outline-none">
                            <input type="text" id="expense-description" placeholder="Description" required
                                class="w-full glass rounded-xl p-3 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-red-400 outline-none">
                            <select id="expense-category" required
                                class="w-full glass rounded-xl p-3 text-white border-0 focus:ring-2 focus:ring-red-400 outline-none bg-white/10">
                                <option value="" class="bg-gray-800 text-white">Select Category</option>
                                <option value="Food" class="bg-gray-800 text-white">Food</option>
                                <option value="Transport" class="bg-gray-800 text-white">Transport</option>
                                <option value="Entertainment" class="bg-gray-800 text-white">Entertainment</option>
                                <option value="Shopping" class="bg-gray-800 text-white">Shopping</option>
                                <option value="Bills" class="bg-gray-800 text-white">Bills</option>
                                <option value="Education" class="bg-gray-800 text-white">Education</option>
                                <option value="Health" class="bg-gray-800 text-white">Health</option>
                                <option value="Other" class="bg-gray-800 text-white">Other</option>
                            </select>
                            <button type="submit" id="expense-submit-btn" class="w-full bg-red-500 hover:bg-red-600 rounded-xl py-3 text-white font-semibold transition-all">
                                Add Expense
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions-tab" class="tab-content hidden">
                <div class="glass rounded-3xl p-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                        <h3 class="text-2xl font-semibold text-white mb-4 md:mb-0">All Transactions</h3>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <input type="text" id="search-transactions" placeholder="Search transactions..."
                                class="glass rounded-xl p-3 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                            <select id="filter-category"
                                class="w-full glass rounded-xl p-3 text-white border-0 focus:ring-2 focus:ring-purple-400 outline-none bg-white/10">
                                <option value="" class="bg-gray-800 text-white">All Categories</option>
                                <option value="Food" class="bg-gray-800 text-white">Food</option>
                                <option value="Transport" class="bg-gray-800 text-white">Transport</option>
                                <option value="Entertainment" class="bg-gray-800 text-white">Entertainment</option>
                                <option value="Shopping" class="bg-gray-800 text-white">Shopping</option>
                                <option value="Bills" class="bg-gray-800 text-white">Bills</option>
                                <option value="Education" class="bg-gray-800 text-white">Education</option>
                                <option value="Health" class="bg-gray-800 text-white">Health</option>
                                <option value="Salary" class="bg-gray-800 text-white">Salary</option>
                                <option value="Freelance" class="bg-gray-800 text-white">Freelance</option>
                                <option value="Family" class="bg-gray-800 text-white">Family Support</option>
                                <option value="Scholarship" class="bg-gray-800 text-white">Scholarship</option>
                                <option value="Other" class="bg-gray-800 text-white">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="transactions-list" class="space-y-4">
                        <div class="text-center text-white/60 py-8">
                            <i class="fas fa-receipt text-4xl mb-4"></i>
                            <p>No transactions yet. Add your first transaction to get started!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Budgets Tab -->
            <div id="budgets-tab" class="tab-content hidden">
                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="glass rounded-3xl p-6">
                        <h3 class="text-2xl font-semibold text-white mb-6">Set Monthly Budget</h3>
                        <form id="budget-form" class="space-y-4">
                            <select id="budget-category" required
                                class="w-full glass rounded-xl p-3 text-white border-0 focus:ring-2 focus:ring-purple-400 outline-none bg-white/10">
                                <option value="" class="bg-gray-800 text-white">Select Category</option>
                                <option value="Food" class="bg-gray-800 text-white">Food</option>
                                <option value="Transport" class="bg-gray-800 text-white">Transport</option>
                                <option value="Entertainment" class="bg-gray-800 text-white">Entertainment</option>
                                <option value="Shopping" class="bg-gray-800 text-white">Shopping</option>
                                <option value="Bills" class="bg-gray-800 text-white">Bills</option>
                                <option value="Education" class="bg-gray-800 text-white">Education</option>
                                <option value="Health" class="bg-gray-800 text-white">Health</option>
                                <option value="Other" class="bg-gray-800 text-white">Other</option>
                            </select>
                            <input type="number" id="budget-limit" placeholder="Monthly Limit (₹)" required
                                class="w-full glass rounded-xl p-3 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                            <button type="submit" class="w-full gradient-bg-alt rounded-xl py-3 text-white font-semibold hover:opacity-90 transition-all">
                                Set Budget
                            </button>
                        </form>
                    </div>
                    
                    <div class="glass rounded-3xl p-6">
                        <h3 class="text-2xl font-semibold text-white mb-6">Current Budgets</h3>
                        <div id="budgets-list" class="space-y-4">
                            <div class="text-center text-white/60 py-8">
                                <i class="fas fa-piggy-bank text-4xl mb-4"></i>
                                <p>No budgets set yet. Create your first budget to track spending!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports-tab" class="tab-content hidden">
                <div class="glass rounded-3xl p-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                        <h3 class="text-2xl font-semibold text-white mb-4 md:mb-0">Monthly Reports</h3>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <select id="report-month"
                                class="w-full glass rounded-xl p-3 text-white border-0 focus:ring-2 focus:ring-purple-400 outline-none bg-white/10">
                                <option value="" class="bg-gray-800 text-white">Select Month</option>
                            </select>
                            <button id="download-csv" class="glass rounded-xl px-6 py-3 text-white hover:bg-white/20 transition-all">
                                <i class="fas fa-download mr-2"></i>Download CSV
                            </button>
                            <button id="download-pdf" class="gradient-bg-alt rounded-xl px-6 py-3 text-white hover:opacity-90 transition-all">
                                <i class="fas fa-file-pdf mr-2"></i>Download PDF
                            </button>
                        </div>
                    </div>
                    
                    <div id="report-summary" class="grid md:grid-cols-3 gap-6 mb-8">
                        <div class="glass rounded-2xl p-4 text-center">
                            <h4 class="text-white/80 mb-2">Total Income</h4>
                            <p id="report-income" class="text-2xl font-bold text-green-400">₹0</p>
                        </div>
                        <div class="glass rounded-2xl p-4 text-center">
                            <h4 class="text-white/80 mb-2">Total Expenses</h4>
                            <p id="report-expenses" class="text-2xl font-bold text-red-400">₹0</p>
                        </div>
                        <div class="glass rounded-2xl p-4 text-center">
                            <h4 class="text-white/80 mb-2">Net Savings</h4>
                            <p id="report-savings" class="text-2xl font-bold text-blue-400">₹0</p>
                        </div>
                    </div>
                    
                    <div id="report-details" class="space-y-4">
                        <div class="text-center text-white/60 py-8">
                            <i class="fas fa-chart-bar text-4xl mb-4"></i>
                            <p>Select a month to view detailed report</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content hidden">
                <div class="max-w-2xl mx-auto">
                    <div class="glass rounded-3xl p-6 mb-6">
                        <h3 class="text-2xl font-semibold text-white mb-6">Profile Settings</h3>
                        <form id="profile-form" class="space-y-4">
                            <div>
                                <label class="block text-white/80 mb-2">Full Name</label>
                                <input type="text" id="profile-name" 
                                    class="w-full glass rounded-xl p-3 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                            </div>
                            <div>
                                <label class="block text-white/80 mb-2">Email</label>
                                <input type="email" id="profile-email" readonly
                                    class="w-full glass rounded-xl p-3 text-white/60 border-0 bg-white/5">
                            </div>
                            <button type="submit" class="gradient-bg-alt rounded-xl px-6 py-3 text-white font-semibold hover:opacity-90 transition-all">
                                Update Profile
                            </button>
                        </form>
                    </div>
                    
                    <div class="glass rounded-3xl p-6 mb-6">
                        <h3 class="text-2xl font-semibold text-white mb-6">Preferences</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-white">Dark Mode</span>
                                <button id="theme-toggle-settings" class="glass rounded-full p-2 text-white hover:bg-white/20 transition-all">
                                    <i class="fas fa-moon"></i>
                                </button>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-white">Currency</span>
                                <select id="currency-select" class="glass rounded-xl p-2 text-white border-0 focus:ring-2 focus:ring-purple-400 outline-none bg-white/10">
                                    <option value="INR" class="bg-gray-800 text-white">₹ INR</option>
                                    <option value="USD" class="bg-gray-800 text-white">$ USD</option>
                                    <option value="EUR" class="bg-gray-800 text-white">€ EUR</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass rounded-3xl p-6">
                        <h3 class="text-2xl font-semibold text-white mb-6">Danger Zone</h3>
                        <button id="delete-account" class="bg-red-500 hover:bg-red-600 rounded-xl px-6 py-3 text-white font-semibold transition-all">
                            <i class="fas fa-trash mr-2"></i>Delete Account
                        </button>
                        <p class="text-white/60 text-sm mt-2">This action cannot be undone.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="transaction-modal" class="modal">
        <div class="glass rounded-3xl p-6 w-full max-w-md mx-4">
            <div class="flex items-center justify-between mb-6">
                <h3 id="modal-title" class="text-2xl font-semibold text-white">Edit Transaction</h3>
                <button id="close-modal" class="text-white/60 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="transaction-form" class="space-y-4">
                <input type="hidden" id="edit-transaction-id">
                <div>
                    <label class="block text-white/80 mb-2">Type</label>
                    <select id="edit-type" required
                        class="w-full glass rounded-xl p-3 text-white border-0 focus:ring-2 focus:ring-purple-400 outline-none bg-white/10">
                        <option value="income" class="bg-gray-800 text-white">Income</option>
                        <option value="expense" class="bg-gray-800 text-white">Expense</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white/80 mb-2">Amount (₹)</label>
                    <input type="number" id="edit-amount" required
                        class="w-full glass rounded-xl p-3 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                </div>
                <div>
                    <label class="block text-white/80 mb-2">Description</label>
                    <input type="text" id="edit-description" required
                        class="w-full glass rounded-xl p-3 text-white placeholder-white/50 border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                </div>
                <div>
                    <label class="block text-white/80 mb-2">Category</label>
                    <select id="edit-category" required
                        class="w-full glass rounded-xl p-3 text-white border-0 focus:ring-2 focus:ring-purple-400 outline-none bg-white/10">
                        <option value="" class="bg-gray-800 text-white">Select Category</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white/80 mb-2">Date</label>
                    <input type="date" id="edit-date" required
                        class="w-full glass rounded-xl p-3 text-white border-0 focus:ring-2 focus:ring-purple-400 outline-none">
                </div>
                <div class="flex gap-4">
                    <button type="submit" class="flex-1 gradient-bg-alt rounded-xl py-3 text-white font-semibold hover:opacity-90 transition-all">
                        Save Changes
                    </button>
                    <button type="button" id="delete-transaction" class="bg-red-500 hover:bg-red-600 rounded-xl px-6 py-3 text-white font-semibold transition-all">
                        Delete
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Application State
        let currentUser = null;
        let transactions = [];
        let budgets = [];
        let isAuthReady = false;
        let isDarkMode = false;
        let currentCurrency = 'INR';
        let transactionsUnsubscribe = null;
        let budgetsUnsubscribe = null;
        
        // Sample data for new users
        const sampleTransactions = [
            { amount: 250, description: 'Lunch at canteen', category: 'Food', date: new Date().toISOString().split('T')[0], type: 'expense' },
            { amount: 15000, description: 'Monthly allowance', category: 'Family', date: new Date().toISOString().split('T')[0], type: 'income' },
            { amount: 80, description: 'Bus fare', category: 'Transport', date: new Date().toISOString().split('T')[0], type: 'expense' }
        ];
        
        const sampleBudgets = [
            { category: 'Food', limit: 5000, spent: 0 },
            { category: 'Transport', limit: 2000, spent: 0 },
            { category: 'Entertainment', limit: 3000, spent: 0 }
        ];

        // --- Utility Functions ---
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const messageEl = document.getElementById('toast-message');
            
            messageEl.textContent = message;
            
            if (type === 'success') {
                icon.className = 'fas fa-check-circle text-green-400';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle text-red-400';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation-triangle text-yellow-400';
            }
            
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showAlert(message, title = 'Alert', type = 'warning', onConfirm = null) {
            const modal = document.getElementById('alert-modal');
            const icon = document.getElementById('alert-icon');
            const titleEl = document.getElementById('alert-title');
            const messageEl = document.getElementById('alert-message');
            const confirmBtn = document.getElementById('alert-confirm');
            const cancelBtn = document.getElementById('alert-cancel');

            titleEl.textContent = title;
            messageEl.textContent = message;

            icon.className = `fas text-3xl`;
            if (type === 'success') {
                icon.className += ' fa-check-circle text-green-400';
            } else if (type === 'error') {
                icon.className += ' fa-times-circle text-red-400';
            } else {
                icon.className += ' fa-exclamation-triangle text-yellow-400';
            }

            confirmBtn.onclick = () => {
                modal.classList.remove('show');
                if (onConfirm) onConfirm();
            };
            cancelBtn.classList.add('hidden');
            modal.classList.add('show');
        }
        
        function formatCurrency(amount) {
            const symbols = { INR: '₹', USD: '$', EUR: '€' };
            const symbol = symbols[currentCurrency] || '₹';
            return `${symbol}${amount.toLocaleString()}`;
        }
        
        // --- Navigation Functions ---
        function showPage(pageId) {
            document.querySelectorAll('#main-content > div').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
        }
        
        function showAuthPage(formType = 'login') {
            showPage('auth-page');
            if (formType === 'login') {
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('signup-form').classList.add('hidden');
            } else {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('signup-form').classList.remove('hidden');
            }
        }
        
        function showDashboard() {
            showPage('dashboard-page');
            showTab('overview');
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'gradient-bg-alt');
                btn.classList.add('glass', 'hover:bg-white/20');
            });
            
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('glass', 'hover:bg-white/20');
                activeBtn.classList.add('active', 'gradient-bg-alt');
            }
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            const content = document.getElementById(`${tabName}-tab`);
            if (content) {
                content.classList.remove('hidden');
            }
            
            if (tabName === 'transactions') { loadTransactions(); }
            else if (tabName === 'budgets') { loadBudgets(); }
            else if (tabName === 'reports') { loadReports(); }
            else if (tabName === 'settings') { loadSettings(); }
            updateDashboard();
        }
        
        // --- Firebase Integration & Authentication ---
        async function setupFirebase() {
            const { auth, db, appId, initialAuthToken, onAuthStateChanged, signInWithCustomToken, signInAnonymously } = window.firebase;
            
            // Sign in anonymously or with custom token
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase auth failed:", error);
            }
            
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    currentUser = user;
                    isAuthReady = true;
                    console.log("User authenticated:", user.uid);
                    // Start listening to Firestore data
                    listenForData(user.uid);
                    checkAndCreateUserDoc(user);
                } else {
                    currentUser = null;
                    isAuthReady = true;
                    console.log("User signed out or not authenticated.");
                    if (transactionsUnsubscribe) transactionsUnsubscribe();
                    if (budgetsUnsubscribe) budgetsUnsubscribe();
                    showPage('landing-page');
                }
            });
        }
        
        async function checkAndCreateUserDoc(user) {
            const { db, doc, getDoc, setDoc, appId, collection, addDoc } = window.firebase;
            const userDocRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/main`);
            const docSnap = await getDoc(userDocRef);
            
            if (!docSnap.exists()) {
                console.log("Creating new user profile doc.");
                await setDoc(userDocRef, {
                    name: 'New User',
                    email: user.email || 'N/A',
                    createdAt: new Date()
                });
                
                // Add sample data for new users
                const transactionsColRef = collection(db, `artifacts/${appId}/users/${user.uid}/transactions`);
                for (const t of sampleTransactions) {
                    await addDoc(transactionsColRef, t);
                }
                const budgetsColRef = collection(db, `artifacts/${appId}/users/${user.uid}/budgets`);
                for (const b of sampleBudgets) {
                    await addDoc(budgetsColRef, b);
                }
            }
        }
        
        function listenForData(userId) {
            const { db, onSnapshot, collection, appId, query } = window.firebase;
            
            // Unsubscribe from previous listeners
            if (transactionsUnsubscribe) transactionsUnsubscribe();
            if (budgetsUnsubscribe) budgetsUnsubscribe();
            
            // Listen to transactions
            const transactionsRef = collection(db, `artifacts/${appId}/users/${userId}/transactions`);
            transactionsUnsubscribe = onSnapshot(transactionsRef, (snapshot) => {
                transactions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateDashboard();
            }, (error) => {
                console.error("Error listening to transactions: ", error);
            });
            
            // Listen to budgets
            const budgetsRef = collection(db, `artifacts/${appId}/users/${userId}/budgets`);
            budgetsUnsubscribe = onSnapshot(budgetsRef, (snapshot) => {
                budgets = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateBudgetSpent();
                updateDashboard();
            }, (error) => {
                console.error("Error listening to budgets: ", error);
            });
        }
        
        async function signup(name, email, password) {
            const { auth, createUserWithEmailAndPassword, db, doc, setDoc, addDoc, collection, appId } = window.firebase;
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Create user profile document with name
                await setDoc(doc(db, `artifacts/${appId}/users/${user.uid}/profile/main`), {
                    name: name,
                    email: user.email,
                    createdAt: new Date()
                });
                
                // Add sample data
                const transactionsColRef = collection(db, `artifacts/${appId}/users/${user.uid}/transactions`);
                for (const t of sampleTransactions) {
                    await addDoc(transactionsColRef, t);
                }
                const budgetsColRef = collection(db, `artifacts/${appId}/users/${user.uid}/budgets`);
                for (const b of sampleBudgets) {
                    await addDoc(budgetsColRef, b);
                }
                
                showToast(`Welcome to HostelHive, ${name}!`);
                return true;
            } catch (error) {
                console.error("Signup failed:", error);
                showToast(`Signup failed: ${error.message}`, 'error');
                return false;
            }
        }
        
        async function login(email, password) {
            const { auth, signInWithEmailAndPassword } = window.firebase;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showToast('Logged in successfully!');
                return true;
            } catch (error) {
                console.error("Login failed:", error);
                showToast(`Login failed: ${error.message}`, 'error');
                return false;
            }
        }
        
        async function logout() {
            const { auth, signOut } = window.firebase;
            try {
                await signOut(auth);
                // The onAuthStateChanged listener will handle UI changes
                showToast('Logged out successfully!');
            } catch (error) {
                console.error("Logout failed:", error);
                showToast(`Logout failed: ${error.message}`, 'error');
            }
        }

        // --- Dashboard Functions ---
        async function updateDashboard() {
            if (!currentUser) return;
            
            // Get user profile name
            const { db, doc, getDoc, appId } = window.firebase;
            const userDocRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/profile/main`);
            const docSnap = await getDoc(userDocRef);
            const userName = docSnap.exists() ? docSnap.data().name : 'User';
            document.getElementById('user-info').textContent = `${userName} (ID: ${currentUser.uid})`;
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyTransactions = transactions.filter(t => {
                const tDate = t.date ? new Date(t.date.seconds * 1000) : new Date();
                return tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
            });
            
            const monthlyIncome = monthlyTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const monthlyExpenses = monthlyTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const monthlyBalance = monthlyIncome - monthlyExpenses;
            
            document.getElementById('total-income').textContent = formatCurrency(monthlyIncome);
            document.getElementById('total-expenses').textContent = formatCurrency(monthlyExpenses);
            document.getElementById('balance').textContent = formatCurrency(monthlyBalance);
            
            const balanceStatus = document.getElementById('balance-status');
            if (monthlyBalance > 0) {
                balanceStatus.textContent = 'Surplus';
                balanceStatus.className = 'text-green-400 text-sm mt-2';
            } else if (monthlyBalance < 0) {
                balanceStatus.textContent = 'Deficit';
                balanceStatus.className = 'text-red-400 text-sm mt-2';
            } else {
                balanceStatus.textContent = 'Break-even';
                balanceStatus.className = 'text-blue-400 text-sm mt-2';
            }
            
            updateExpenseFormState(monthlyIncome, monthlyBalance);
            updateCharts();
        }
        
        function updateExpenseFormState(totalIncome, availableBalance) {
            const balanceWarning = document.getElementById('balance-warning');
            const availableBalanceSpan = document.getElementById('available-balance');
            const expenseSubmitBtn = document.getElementById('expense-submit-btn');
            
            if (totalIncome === 0) {
                balanceWarning.classList.remove('hidden');
                balanceWarning.className = 'mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-xl';
                balanceWarning.innerHTML = `<div class="flex items-center text-red-300"> <i class="fas fa-exclamation-circle mr-2"></i> <span class="text-sm">Please add your income first before recording expenses!</span> </div>`;
                expenseSubmitBtn.disabled = true;
                expenseSubmitBtn.className = 'w-full bg-gray-500 rounded-xl py-3 text-white font-semibold cursor-not-allowed';
                expenseSubmitBtn.textContent = 'Add Income First';
            } else {
                balanceWarning.classList.remove('hidden');
                balanceWarning.className = 'mb-4 p-3 bg-blue-500/20 border border-blue-500/50 rounded-xl';
                availableBalanceSpan.textContent = formatCurrency(availableBalance);
                balanceWarning.innerHTML = `<div class="flex items-center text-blue-300"> <i class="fas fa-info-circle mr-2"></i> <span class="text-sm">Available Balance: <span id="available-balance">${formatCurrency(availableBalance)}</span></span> </div>`;
                expenseSubmitBtn.disabled = false;
                expenseSubmitBtn.className = 'w-full bg-red-500 hover:bg-red-600 rounded-xl py-3 text-white font-semibold transition-all';
                expenseSubmitBtn.textContent = 'Add Expense';
            }
            
            if (availableBalance <= 0) {
                balanceWarning.className = 'mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-xl';
                balanceWarning.innerHTML = `<div class="flex items-center text-red-300"> <i class="fas fa-exclamation-triangle mr-2"></i> <span class="text-sm">No balance available for expenses!</span> </div>`;
                expenseSubmitBtn.disabled = true;
                expenseSubmitBtn.className = 'w-full bg-gray-500 rounded-xl py-3 text-white font-semibold cursor-not-allowed';
                expenseSubmitBtn.textContent = 'Insufficient Balance';
            }
        }
        
        // --- Chart Functions ---
        function updateCharts() {
            updateCategoryChart();
            updateTrendChart();
        }
        
        function updateCategoryChart() {
            const ctx = document.getElementById('categoryChart');
            if (!ctx) return;
            
            const expensesByCategory = {};
            transactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
                });
            
            const labels = Object.keys(expensesByCategory);
            const data = Object.values(expensesByCategory);
            
            if (labels.length === 0) {
                if (window.categoryChartInstance) {
                    window.categoryChartInstance.destroy();
                    window.categoryChartInstance = null;
                }
                return;
            }
            
            if (window.categoryChartInstance) {
                window.categoryChartInstance.data.labels = labels;
                window.categoryChartInstance.data.datasets[0].data = data;
                window.categoryChartInstance.update();
                return;
            }
            
            const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'];
            
            window.categoryChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'white',
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }
        
        function updateTrendChart() {
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;
            
            const months = [];
            const incomeData = [];
            const expenseData = [];
            
            for (let i = 2; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                months.push(date.toLocaleDateString('en-US', { month: 'short' }));
                
                const monthTransactions = transactions.filter(t => {
                    const tDate = t.date ? new Date(t.date.seconds * 1000) : new Date();
                    return tDate.getMonth() === date.getMonth() && tDate.getFullYear() === date.getFullYear();
                });
                
                const monthIncome = monthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthExpenses = monthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                incomeData.push(monthIncome);
                expenseData.push(monthExpenses);
            }
            
            if (window.trendChartInstance) {
                window.trendChartInstance.data.labels = months;
                window.trendChartInstance.data.datasets[0].data = incomeData;
                window.trendChartInstance.data.datasets[1].data = expenseData;
                window.trendChartInstance.update();
                return;
            }
            
            window.trendChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Income',
                            data: incomeData,
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.1
                        },
                        {
                            label: 'Expenses',
                            data: expenseData,
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white',
                                font: { size: 11 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: 'rgba(255, 255, 255, 0.8)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: 'rgba(255, 255, 255, 0.8)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // --- Firestore Data Operations ---
        async function addTransaction(type, amount, description, category) {
            if (!currentUser) {
                showAlert('Please sign in to add transactions.');
                return false;
            }
            const { db, collection, addDoc, appId } = window.firebase;
            
            const transactionData = {
                type,
                amount: parseFloat(amount),
                description,
                category,
                date: new Date(),
            };
            
            try {
                await addDoc(collection(db, `artifacts/${appId}/users/${currentUser.uid}/transactions`), transactionData);
                showToast(`${type === 'income' ? 'Income' : 'Expense'} added successfully!`);
                checkBudgetAlerts(category, amount);
                return true;
            } catch (error) {
                console.error("Error adding document: ", error);
                showAlert(`Failed to add transaction. Please try again.`, 'Error', 'error');
                return false;
            }
        }
        
        async function editTransaction(id, data) {
            if (!currentUser) {
                showAlert('Please sign in to edit transactions.');
                return;
            }
            const { db, doc, setDoc, appId } = window.firebase;
            
            try {
                const transactionDocRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/transactions`, id);
                await setDoc(transactionDocRef, data, { merge: true });
                showToast('Transaction updated successfully!');
            } catch (error) {
                console.error("Error updating document: ", error);
                showAlert(`Failed to update transaction. Please try again.`, 'Error', 'error');
            }
        }
        
        async function deleteTransaction(id) {
            if (!currentUser) {
                showAlert('Please sign in to delete transactions.');
                return;
            }
            const { db, doc, deleteDoc, appId } = window.firebase;
            
            try {
                await deleteDoc(doc(db, `artifacts/${appId}/users/${currentUser.uid}/transactions`, id));
                showToast('Transaction deleted successfully!');
            } catch (error) {
                console.error("Error removing document: ", error);
                showAlert(`Failed to delete transaction. Please try again.`, 'Error', 'error');
            }
        }
        
        function loadTransactions() {
            const container = document.getElementById('transactions-list');
            if (!container) return;
            
            if (transactions.length === 0) {
                container.innerHTML = `<div class="text-center text-white/60 py-8"> <i class="fas fa-receipt text-4xl mb-4"></i> <p>No transactions yet. Add your first transaction to get started!</p> </div>`;
                return;
            }
            
            const searchInput = document.getElementById('search-transactions');
            const filterSelect = document.getElementById('filter-category');
            
            const searchTerm = searchInput.value.toLowerCase();
            const filterCategory = filterSelect.value;
            
            const filteredTransactions = transactions.filter(t => {
                const matchesSearch = !searchTerm || t.description.toLowerCase().includes(searchTerm) || t.category.toLowerCase().includes(searchTerm);
                const matchesCategory = !filterCategory || t.category === filterCategory;
                return matchesSearch && matchesCategory;
            });
            
            filteredTransactions.sort((a, b) => (b.date.seconds - a.date.seconds));
            const displayTransactions = filteredTransactions;
            
            const transactionHTML = displayTransactions.map(t => {
                const formattedDate = new Date(t.date.seconds * 1000).toLocaleDateString();
                const amountColor = t.type === 'income' ? 'text-green-400' : 'text-red-400';
                const bgColor = t.type === 'income' ? 'bg-green-500' : 'bg-red-500';
                const icon = t.type === 'income' ? 'fa-arrow-up' : 'fa-arrow-down';
                const sign = t.type === 'income' ? '+' : '-';
                
                return `
                    <div class="glass rounded-2xl p-4 hover:bg-white/10 transition-all cursor-pointer" onclick="openTransactionModal('${t.id}')">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 ${bgColor} rounded-xl flex items-center justify-center">
                                    <i class="fas ${icon} text-white"></i>
                                </div>
                                <div>
                                    <h4 class="text-white font-semibold">${t.description}</h4>
                                    <p class="text-white/60 text-sm">${t.category} • ${formattedDate}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold ${amountColor}">
                                    ${sign}${formatCurrency(t.amount)}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = transactionHTML;
        }

        function openTransactionModal(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) return;
            
            document.getElementById('edit-transaction-id').value = transaction.id;
            document.getElementById('edit-type').value = transaction.type;
            document.getElementById('edit-amount').value = transaction.amount;
            document.getElementById('edit-description').value = transaction.description;
            document.getElementById('edit-date').value = new Date(transaction.date.seconds * 1000).toISOString().split('T')[0];
            
            const categorySelect = document.getElementById('edit-category');
            const categories = transaction.type === 'income'
                ? ['Salary', 'Freelance', 'Family', 'Scholarship', 'Other']
                : ['Food', 'Transport', 'Entertainment', 'Shopping', 'Bills', 'Education', 'Health', 'Other'];
            
            categorySelect.innerHTML = categories.map(cat => 
                `<option value="${cat}" class="bg-gray-800 text-white" ${cat === transaction.category ? 'selected' : ''}>${cat}</option>`
            ).join('');
            
            document.getElementById('transaction-modal').classList.add('show');
        }

        // --- Budgets ---
        async function addBudget(category, limit) {
            if (!currentUser) {
                showAlert('Please sign in to set budgets.');
                return;
            }
            const { db, doc, setDoc, appId } = window.firebase;
            
            try {
                // Check if budget for this category already exists
                const existingBudget = budgets.find(b => b.category === category);
                const budgetDocRef = existingBudget ? doc(db, `artifacts/${appId}/users/${currentUser.uid}/budgets`, existingBudget.id) : null;
                
                const budgetData = {
                    category: category,
                    limit: parseFloat(limit),
                };
                
                if (budgetDocRef) {
                    await setDoc(budgetDocRef, budgetData, { merge: true });
                } else {
                    const newBudgetRef = doc(collection(db, `artifacts/${appId}/users/${currentUser.uid}/budgets`));
                    await setDoc(newBudgetRef, budgetData);
                }
                showToast('Budget updated successfully!');
            } catch (error) {
                console.error("Error setting budget: ", error);
                showAlert(`Failed to set budget. Please try again.`, 'Error', 'error');
            }
        }
        
        function updateBudgetSpent() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            budgets.forEach(budget => {
                const spent = transactions
                    .filter(t => {
                        const tDate = t.date ? new Date(t.date.seconds * 1000) : new Date();
                        return t.type === 'expense' &&
                               t.category === budget.category &&
                               tDate.getMonth() === currentMonth &&
                               tDate.getFullYear() === currentYear;
                    })
                    .reduce((sum, t) => sum + t.amount, 0);
                
                budget.spent = spent;
            });
        }
        
        function loadBudgets() {
            updateBudgetSpent();
            
            const container = document.getElementById('budgets-list');
            if (budgets.length === 0) {
                container.innerHTML = `<div class="text-center text-white/60 py-8"> <i class="fas fa-piggy-bank text-4xl mb-4"></i> <p>No budgets set yet. Create your first budget to track spending!</p> </div>`;
                return;
            }
            
            container.innerHTML = budgets.map(budget => {
                const percentage = budget.spent > 0 ? (budget.spent / budget.limit) * 100 : 0;
                const isOverBudget = percentage > 100;
                const isNearLimit = percentage > 80 && !isOverBudget;
                
                return `
                    <div class="glass rounded-2xl p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-white font-semibold">${budget.category}</h4>
                            <span class="text-white/80">${formatCurrency(budget.spent)} / ${formatCurrency(budget.limit)}</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-3 mb-2">
                            <div class="h-3 rounded-full transition-all ${
                                isOverBudget ? 'bg-red-500' : isNearLimit ? 'bg-yellow-500' : 'bg-green-500'
                            }" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-white/60">${percentage.toFixed(1)}% used</span>
                            ${isOverBudget ? '<span class="text-red-400">Over budget!</span>' : 
                              isNearLimit ? '<span class="text-yellow-400">Near limit</span>' : 
                              '<span class="text-green-400">On track</span>'}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function checkBudgetAlerts(category, amount) {
            const budget = budgets.find(b => b.category === category);
            if (!budget) return;
            
            updateBudgetSpent();
            const percentage = (budget.spent / budget.limit) * 100;
            
            if (percentage >= 100) {
                showToast(`You've exceeded your ${category} budget!`, 'error');
            } else if (percentage >= 80) {
                showToast(`You're near your ${category} budget limit (${percentage.toFixed(1)}%)`, 'warning');
            }
        }
        
        // --- Reports ---
        function loadReports() {
            const monthSelect = document.getElementById('report-month');
            const months = [];
            
            transactions.forEach(t => {
                const date = t.date ? new Date(t.date.seconds * 1000) : new Date();
                const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                if (!months.includes(monthYear)) {
                    months.push(monthYear);
                }
            });
            
            const currentMonth = new Date();
            const currentMonthYear = `${currentMonth.getFullYear()}-${String(currentMonth.getMonth() + 1).padStart(2, '0')}`;
            if (!months.includes(currentMonthYear)) {
                months.push(currentMonthYear);
            }
            
            months.sort().reverse();
            
            monthSelect.innerHTML = '<option value="" class="bg-gray-800 text-white">Select Month</option>' + 
                months.map(month => {
                    const date = new Date(month + '-01');
                    const label = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    return `<option value="${month}" class="bg-gray-800 text-white">${label}</option>`;
                }).join('');
        }

        function generateReport(month) {
            if (!month) {
                document.getElementById('report-details').innerHTML = `<div class="text-center text-white/60 py-8"> <i class="fas fa-chart-bar text-4xl mb-4"></i> <p>Select a month to view detailed report</p> </div>`;
                document.getElementById('report-income').textContent = formatCurrency(0);
                document.getElementById('report-expenses').textContent = formatCurrency(0);
                document.getElementById('report-savings').textContent = formatCurrency(0);
                return;
            }
            
            const [year, monthNum] = month.split('-');
            const monthTransactions = transactions.filter(t => {
                const tDate = t.date ? new Date(t.date.seconds * 1000) : new Date();
                return tDate.getFullYear() == year && tDate.getMonth() == (monthNum - 1);
            });
            
            const income = monthTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = monthTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const savings = income - expenses;
            
            document.getElementById('report-income').textContent = formatCurrency(income);
            document.getElementById('report-expenses').textContent = formatCurrency(expenses);
            document.getElementById('report-savings').textContent = formatCurrency(savings);
            document.getElementById('report-savings').className = `text-2xl font-bold ${savings >= 0 ? 'text-green-400' : 'text-red-400'}`;
            
            const container = document.getElementById('report-details');
            if (monthTransactions.length === 0) {
                container.innerHTML = `<div class="text-center text-white/60 py-8"> <i class="fas fa-chart-bar text-4xl mb-4"></i> <p>No transactions found for this month</p> </div>`;
                return;
            }
            
            const categoryBreakdown = {};
            monthTransactions.forEach(t => {
                if (!categoryBreakdown[t.category]) {
                    categoryBreakdown[t.category] = { income: 0, expense: 0 };
                }
                categoryBreakdown[t.category][t.type] += t.amount;
            });
            
            container.innerHTML = `
                <h4 class="text-xl font-semibold text-white mb-4">Category Breakdown</h4>
                <div class="space-y-3">
                    ${Object.entries(categoryBreakdown).map(([category, amounts]) => `
                        <div class="glass rounded-xl p-4">
                            <div class="flex items-center justify-between">
                                <span class="text-white font-medium">${category}</span>
                                <div class="text-right">
                                    ${amounts.income > 0 ? `<div class="text-green-400">+${formatCurrency(amounts.income)}</div>` : ''}
                                    ${amounts.expense > 0 ? `<div class="text-red-400">-${formatCurrency(amounts.expense)}</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // --- Settings & UI ---
        function loadSettings() {
            if (currentUser) {
                const { db, doc, onSnapshot, appId } = window.firebase;
                const userDocRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/profile/main`);
                onSnapshot(userDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        document.getElementById('profile-name').value = docSnap.data().name;
                    }
                });
                document.getElementById('profile-email').value = currentUser.email;
            }
            
            const savedCurrency = localStorage.getItem('hostelhive_currency');
            if (savedCurrency) {
                currentCurrency = savedCurrency;
            }
            document.getElementById('currency-select').value = currentCurrency;
            
            const savedTheme = localStorage.getItem('hostelhive_theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
                isDarkMode = true;
            } else {
                document.body.classList.remove('dark');
                isDarkMode = false;
            }
            updateThemeIcons();
        }
        
        async function updateProfile(name) {
            if (!currentUser) return;
            const { db, doc, setDoc, appId } = window.firebase;
            
            try {
                const userDocRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/profile/main`);
                await setDoc(userDocRef, { name: name }, { merge: true });
                showToast('Profile updated successfully!');
            } catch (error) {
                console.error("Error updating profile:", error);
                showAlert(`Failed to update profile.`, 'Error', 'error');
            }
        }
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark', isDarkMode);
            localStorage.setItem('hostelhive_theme', isDarkMode ? 'dark' : 'light');
            updateThemeIcons();
        }
        
        function updateThemeIcons() {
            const themeIcons = document.querySelectorAll('#theme-toggle i, #theme-toggle-settings i');
            themeIcons.forEach(icon => {
                icon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            });
        }
        
        async function deleteAccount() {
            const result = new Promise(resolve => {
                const modal = document.getElementById('alert-modal');
                document.getElementById('alert-title').textContent = 'Confirm Account Deletion';
                document.getElementById('alert-message').textContent = 'Are you sure you want to delete your account? This action cannot be undone.';
                document.getElementById('alert-icon').className = 'fas fa-trash-alt text-3xl text-red-400';
                
                const confirmBtn = document.getElementById('alert-confirm');
                const cancelBtn = document.getElementById('alert-cancel');
                cancelBtn.classList.remove('hidden');
                
                confirmBtn.onclick = () => {
                    modal.classList.remove('show');
                    resolve(true);
                };
                cancelBtn.onclick = () => {
                    modal.classList.remove('show');
                    resolve(false);
                };
                modal.classList.add('show');
            });
            
            if (await result) {
                try {
                    await currentUser.delete();
                    showToast('Account deleted successfully!');
                    logout();
                } catch (error) {
                    console.error("Error deleting account:", error);
                    showAlert(`Failed to delete account. You may need to sign in again.`, 'Error', 'error');
                }
            }
        }
        
        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', async function() {
            await setupFirebase();
            
            // Check auth state on initial load
            const { auth } = window.firebase;
            if (auth.currentUser) {
                showDashboard();
            }
            
            // Landing page navigation
            document.getElementById('nav-login').addEventListener('click', () => showAuthPage('login'));
            document.getElementById('nav-signup').addEventListener('click', () => showAuthPage('signup'));
            document.getElementById('hero-signup').addEventListener('click', () => showAuthPage('signup'));
            document.getElementById('footer-signup').addEventListener('click', () => showAuthPage('signup'));
            document.getElementById('hero-demo').addEventListener('click', () => {
                showAlert('Demo mode is not available with the new database. Please create an account to start tracking!');
            });
            
            // Auth form toggles
            document.getElementById('show-signup').addEventListener('click', () => showAuthPage('signup'));
            document.getElementById('show-login').addEventListener('click', () => showAuthPage('login'));
            document.getElementById('back-to-home').addEventListener('click', () => showPage('landing-page'));
            document.getElementById('back-to-home-signup').addEventListener('click', () => showPage('landing-page'));
            
            // Auth forms
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                if (await login(email, password)) {
                    this.reset();
                }
            });
            
            document.getElementById('signupForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                if (await signup(name, email, password)) {
                    this.reset();
                }
            });
            
            // Dashboard tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => showTab(btn.dataset.tab));
            });
            
            // Quick add forms
            document.getElementById('quick-income-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const amount = document.getElementById('income-amount').value;
                const description = document.getElementById('income-description').value;
                const category = document.getElementById('income-category').value;
                await addTransaction('income', amount, description, category);
                this.reset();
            });
            
            document.getElementById('quick-expense-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const amount = document.getElementById('expense-amount').value;
                const description = document.getElementById('expense-description').value;
                const category = document.getElementById('expense-category').value;
                await addTransaction('expense', amount, description, category);
                this.reset();
            });
            
            // Transaction search and filter
            document.getElementById('search-transactions').addEventListener('input', loadTransactions);
            document.getElementById('filter-category').addEventListener('change', loadTransactions);
            
            // Budget form
            document.getElementById('budget-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const category = document.getElementById('budget-category').value;
                const limit = document.getElementById('budget-limit').value;
                await addBudget(category, limit);
                this.reset();
            });
            
            // Reports
            document.getElementById('report-month').addEventListener('change', function() {
                generateReport(this.value);
            });
            
            document.getElementById('download-csv').addEventListener('click', function() {
                const month = document.getElementById('report-month').value;
                downloadCSV(month);
            });
            
            document.getElementById('download-pdf').addEventListener('click', function() {
                const month = document.getElementById('report-month').value;
                downloadPDF(month);
            });
            
            // Settings
            document.getElementById('profile-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const name = document.getElementById('profile-name').value;
                await updateProfile(name);
            });
            
            document.getElementById('currency-select').addEventListener('change', function() {
                currentCurrency = this.value;
                localStorage.setItem('hostelhive_currency', currentCurrency);
                updateDashboard();
                showToast('Currency updated successfully!');
            });
            
            document.getElementById('delete-account').addEventListener('click', deleteAccount);
            
            // Theme toggles
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            document.getElementById('theme-toggle-settings').addEventListener('click', toggleTheme);
            
            // Logout
            document.getElementById('logout-btn').addEventListener('click', logout);
            
            // Transaction modal
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('transaction-modal').classList.remove('show');
            });
            
            document.getElementById('transaction-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const id = document.getElementById('edit-transaction-id').value;
                const data = {
                    type: document.getElementById('edit-type').value,
                    amount: parseFloat(document.getElementById('edit-amount').value),
                    description: document.getElementById('edit-description').value,
                    category: document.getElementById('edit-category').value,
                    date: new Date(document.getElementById('edit-date').value)
                };
                await editTransaction(id, data);
                document.getElementById('transaction-modal').classList.remove('show');
            });
            
            document.getElementById('delete-transaction').addEventListener('click', async function() {
                const id = document.getElementById('edit-transaction-id').value;
                const result = new Promise(resolve => {
                    const modal = document.getElementById('alert-modal');
                    document.getElementById('alert-title').textContent = 'Confirm Deletion';
                    document.getElementById('alert-message').textContent = 'Are you sure you want to delete this transaction?';
                    document.getElementById('alert-icon').className = 'fas fa-trash-alt text-3xl text-red-400';
                    document.getElementById('alert-cancel').classList.remove('hidden');
                    
                    document.getElementById('alert-confirm').onclick = () => { modal.classList.remove('show'); resolve(true); };
                    document.getElementById('alert-cancel').onclick = () => { modal.classList.remove('show'); resolve(false); };
                    modal.classList.add('show');
                });
                if (await result) {
                    await deleteTransaction(id);
                    document.getElementById('transaction-modal').classList.remove('show');
                }
            });
            
            document.getElementById('edit-type').addEventListener('change', function() {
                const categorySelect = document.getElementById('edit-category');
                const categories = this.value === 'income'
                    ? ['Salary', 'Freelance', 'Family', 'Scholarship', 'Other']
                    : ['Food', 'Transport', 'Entertainment', 'Shopping', 'Bills', 'Education', 'Health', 'Other'];
                
                categorySelect.innerHTML = '<option value="" class="bg-gray-800 text-white">Select Category</option>' + 
                    categories.map(cat => `<option value="${cat}" class="bg-gray-800 text-white">${cat}</option>`).join('');
            });
            
            document.querySelectorAll('.faq-toggle').forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const content = this.nextElementSibling;
                    const icon = this.querySelector('i');
                    content.classList.toggle('hidden');
                    icon.style.transform = content.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
                });
            });
            
            document.getElementById('transaction-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                }
            });
        });
    </script>
</body>
</html>

